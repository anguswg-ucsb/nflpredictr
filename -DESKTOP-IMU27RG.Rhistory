date = date_header
) %>%
stats::setNames(c("matchup", "spread", "total", "moneyline", "homeaway", "date")) %>%
# dplyr::mutate(team_name = unlist(strsplit(matchup, " "))[[1]])
dplyr::mutate(
team_name = str_extract(matchup,"\\w+$"),
game_num  = sort(rep(seq(1, nrow(.)/2), 2))
) %>%
dplyr::group_by(game_num) %>%
dplyr::group_split()
tmp <- odds_tbl2[[1]]
tmp
tmp <- odds_tbl2[[1]] %>%
tidyr::pivot_wider(names_from = team_name, values_from = homeaway)
# tmp <-
odds_tbl2[[1]] %>%
tidyr::pivot_wider(names_from = team_name, values_from = homeaway)
# tmp <-
odds_tbl2[[1]] %>%
tidyr::pivot_wider(names_from = homeaway, values_from = team_name)
odds_tbl2[[1]] %>%
dplyr::group_by(homeaway)
odds_tbl2[[1]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup)
odds_tbl2[[1]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup) %>%
dplyr::rename(team = team_abbr) %>%
dplyr::mutate(
spread =  as.numeric(sub("-[^-]+$", "", spread)),
total  =  dplyr::case_when(
grepl("U", total) ~ (gsub("U", "", sub("-[^-]+$", "", total))),
grepl("O", total) ~ (gsub("O", "", sub("-[^-]+$", "", total)))
)
) %>%
dplyr::ungroup()
tmp <-
odds_tbl2[[1]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup) %>%
dplyr::rename(team = team_abbr) %>%
dplyr::mutate(
spread =  as.numeric(sub("-[^-]+$", "", spread)),
total  =  dplyr::case_when(
grepl("U", total) ~ (gsub("U", "", sub("-[^-]+$", "", total))),
grepl("O", total) ~ (gsub("O", "", sub("-[^-]+$", "", total)))
)
) %>%
dplyr::ungroup()
tmp
# home team
home <-
tmp %>%
dplyr::filter(homeaway == "home_team") %>%
dplyr::relocate(home_team = team) %>%
dplyr::select(-homeaway, -team_name)
home
# away team
away <-
tmp %>%
dplyr::filter(homeaway == "away_team") %>%
dplyr::select(away_team = team)
away
# Bind columns of home and away teams into single row
vegas_odds <-
home %>%
dplyr::bind_cols(away) %>%
dplyr::mutate(
favored = dplyr::case_when(
spread > 0  ~ 0,  # If spread is positive, away team is favored,
spread < 0  ~ 1,  # If spread is negative, home team is favored
spread == 0 ~ 0
)
) %>%
dplyr::relocate(home_team, away_team, favored)
vegas_odds
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table() %>%
dplyr::mutate(homeaway = if_else(row_number() %% 2 == 0, paste0("home_team"), "away_team"))
# extract date column name
date_header <- names(odds_tbl)[1]
# clean up odds table
odds_tbl <-
odds_tbl %>%
dplyr::mutate(
date = date_header
) %>%
stats::setNames(c("matchup", "spread", "total", "moneyline", "homeaway", "date")) %>%
# dplyr::mutate(team_name = unlist(strsplit(matchup, " "))[[1]])
dplyr::mutate(
team_name = str_extract(matchup,"\\w+$"),
game_num  = sort(rep(seq(1, nrow(.)/2), 2))
) %>%
dplyr::group_by(game_num) %>%
dplyr::group_split()
1:length(odds_tbl)
# tmp <-
# odds_tbl2[[1]] %>%
# tidyr::pivot_wider(names_from = homeaway, values_from = team_name)
z <- 1
odds_sub <-
odds_tbl[[z]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup) %>%
dplyr::rename(team = team_abbr) %>%
dplyr::mutate(
spread =  as.numeric(sub("-[^-]+$", "", spread)),
total  =  dplyr::case_when(
grepl("U", total) ~ (gsub("U", "", sub("-[^-]+$", "", total))),
grepl("O", total) ~ (gsub("O", "", sub("-[^-]+$", "", total)))
)
) %>%
dplyr::ungroup()
View(odds_sub)
# home team
home <-
tmp %>%
dplyr::filter(homeaway == "home_team") %>%
dplyr::relocate(home_team = team) %>%
dplyr::select(-homeaway, -team_name)
# away team
away <-
tmp %>%
dplyr::filter(homeaway == "away_team") %>%
dplyr::select(away_team = team)
# Bind columns of home and away teams into single row
vegas_odds <-
home %>%
dplyr::bind_cols(away) %>%
dplyr::mutate(
favored = dplyr::case_when(
spread > 0  ~ 0,  # If spread is positive, away team is favored,
spread < 0  ~ 1,  # If spread is negative, home team is favored
spread == 0 ~ 0
)
) %>%
dplyr::relocate(home_team, away_team, favored)
odds_sub <-
odds_tbl[[z]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup) %>%
dplyr::rename(team = team_abbr) %>%
dplyr::mutate(
spread =  as.numeric(sub("-[^-]+$", "", spread)),
total  =  dplyr::case_when(
grepl("U", total) ~ (gsub("U", "", sub("-[^-]+$", "", total))),
grepl("O", total) ~ (gsub("O", "", sub("-[^-]+$", "", total)))
)
) %>%
dplyr::ungroup()
# home team
home <-
odds_sub %>%
dplyr::filter(homeaway == "home_team") %>%
dplyr::relocate(home_team = team) %>%
dplyr::select(-homeaway, -team_name)
# away team
away <-
odds_sub %>%
dplyr::filter(homeaway == "away_team") %>%
dplyr::select(away_team = team)
# Bind columns of home and away teams into single row
vegas_odds <-
home %>%
dplyr::bind_cols(away) %>%
dplyr::mutate(
favored = dplyr::case_when(
spread > 0  ~ 0,  # If spread is positive, away team is favored,
spread < 0  ~ 1,  # If spread is negative, home team is favored
spread == 0 ~ 0
)
) %>%
dplyr::relocate(home_team, away_team, favored)
View(vegas_odds)
sub_tbl_lst <- list()
i = 1
odds_lst <- list()
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table() %>%
dplyr::mutate(homeaway = if_else(row_number() %% 2 == 0, paste0("home_team"), "away_team"))
odds_tbl
# extract date column name
date_header <- names(odds_tbl)[1]
# clean up odds table
odds_tbl <-
odds_tbl %>%
dplyr::mutate(
date = date_header
) %>%
stats::setNames(c("matchup", "spread", "total", "moneyline", "homeaway", "date")) %>%
# dplyr::mutate(team_name = unlist(strsplit(matchup, " "))[[1]])
dplyr::mutate(
team_name = str_extract(matchup,"\\w+$"),
game_num  = sort(rep(seq(1, nrow(.)/2), 2))
) %>%
dplyr::group_by(game_num) %>%
dplyr::group_split()
odds_tbl
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table() %>%
dplyr::mutate(homeaway = if_else(row_number() %% 2 == 0, paste0("home_team"), "away_team"))
# extract date column name
date_header <- names(odds_tbl)[1]
odds_tbl %>%
dplyr::mutate(
date = date_header
) %>%
stats::setNames(c("matchup", "spread", "total", "moneyline", "homeaway", "date")) %>%
# dplyr::mutate(team_name = unlist(strsplit(matchup, " "))[[1]])
dplyr::mutate(
team_name = str_extract(matchup,"\\w+$"),
game_num  = sort(rep(seq(1, nrow(.)/2), 2))
) %>%
dplyr::group_by(game_num) %>%
dplyr::group_split()
# clean up odds table
odds_tbl <-
odds_tbl %>%
dplyr::mutate(
date = date_header
) %>%
stats::setNames(c("matchup", "spread", "total", "moneyline", "homeaway", "date")) %>%
# dplyr::mutate(team_name = unlist(strsplit(matchup, " "))[[1]])
dplyr::mutate(
team_name = str_extract(matchup,"\\w+$"),
game_num  = sort(rep(seq(1, nrow(.)/2), 2))
) %>%
dplyr::group_by(game_num) %>%
dplyr::group_split()
odds_tbl
sub_tbl_lst <- list()
1:length(odds_tbl)
z <- 1
odds_sub <-
odds_tbl[[z]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup) %>%
dplyr::rename(team = team_abbr) %>%
dplyr::mutate(
spread =  as.numeric(sub("-[^-]+$", "", spread)),
total  =  dplyr::case_when(
grepl("U", total) ~ (gsub("U", "", sub("-[^-]+$", "", total))),
grepl("O", total) ~ (gsub("O", "", sub("-[^-]+$", "", total)))
)
) %>%
dplyr::ungroup()
# home team
home <-
odds_sub %>%
dplyr::filter(homeaway == "home_team") %>%
dplyr::relocate(home_team = team) %>%
dplyr::select(-homeaway, -team_name)
# away team
away <-
odds_sub %>%
dplyr::filter(homeaway == "away_team") %>%
dplyr::select(away_team = team)
# Bind columns of home and away teams into single row
vegas_odds <-
home %>%
dplyr::bind_cols(away) %>%
dplyr::mutate(
favored = dplyr::case_when(
spread > 0  ~ 0,  # If spread is positive, away team is favored,
spread < 0  ~ 1,  # If spread is negative, home team is favored
spread == 0 ~ 0
)
) %>%
dplyr::relocate(home_team, away_team, favored)
View(vegas_odds)
vegas_tbls
for (i in 1:length(vegas_tbls)) {
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table() %>%
dplyr::mutate(homeaway = if_else(row_number() %% 2 == 0, paste0("home_team"), "away_team"))
# %>%
# rvest::html_table(header = FALSE) %>%
# dplyr::mutate(homeaway = c("away_team", "home_team"))
# extract date column name
date_header <- names(odds_tbl)[1]
# clean up odds table
odds_tbl <-
odds_tbl %>%
dplyr::mutate(
date = date_header
) %>%
stats::setNames(c("matchup", "spread", "total", "moneyline", "homeaway", "date")) %>%
# dplyr::mutate(team_name = unlist(strsplit(matchup, " "))[[1]])
dplyr::mutate(
team_name = str_extract(matchup,"\\w+$"),
game_num  = sort(rep(seq(1, nrow(.)/2), 2))
) %>%
dplyr::group_by(game_num) %>%
dplyr::group_split()
sub_tbl_lst <- list()
# z <- 1
for (z in 1:length(odds_tbl)) {
# tmp <-
# odds_tbl2[[1]] %>%
# tidyr::pivot_wider(names_from = homeaway, values_from = team_name)
odds_sub <-
odds_tbl[[z]] %>%
dplyr::group_by(homeaway) %>%
dplyr::mutate(
team = dplyr::case_when(
grepl("AM", matchup) ~  unlist(strsplit(matchup, "AM"))[2],
grepl("PM", matchup) ~  unlist(strsplit(matchup, "PM"))[2]
),
team_abbr = unlist(strsplit(team, " "))[1],
team_name = unlist(strsplit(team, " "))[2],
) %>%
dplyr::select(-team, -matchup) %>%
dplyr::rename(team = team_abbr) %>%
dplyr::mutate(
spread =  as.numeric(sub("-[^-]+$", "", spread)),
total  =  dplyr::case_when(
grepl("U", total) ~ (gsub("U", "", sub("-[^-]+$", "", total))),
grepl("O", total) ~ (gsub("O", "", sub("-[^-]+$", "", total)))
)
) %>%
dplyr::ungroup()
# home team
home <-
odds_sub %>%
dplyr::filter(homeaway == "home_team") %>%
dplyr::relocate(home_team = team) %>%
dplyr::select(-homeaway, -team_name)
# away team
away <-
odds_sub %>%
dplyr::filter(homeaway == "away_team") %>%
dplyr::select(away_team = team)
# Bind columns of home and away teams into single row
vegas_odds <-
home %>%
dplyr::bind_cols(away) %>%
dplyr::mutate(
favored = dplyr::case_when(
spread > 0  ~ 0,  # If spread is positive, away team is favored,
spread < 0  ~ 1,  # If spread is negative, home team is favored
spread == 0 ~ 0
)
) %>%
dplyr::relocate(home_team, away_team, favored)
sub_tbl_lst[[z]] <- vegas_odds
}
odds_lst[[i]] <- dplyr::bind_rows(sub_tbl_lst)
}
i = 9
rm(i)
odds_lst <- list()
i = 9
# rm(i)
odds_lst <- list()
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table() %>%
dplyr::mutate(homeaway = if_else(row_number() %% 2 == 0, paste0("home_team"), "away_team"))
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
# vegas_url <- "https://vegas-odds.com/nfl/odds/"
# vegas_url <- "https://sportsbook.draftkings.com/leagues/football/nfl"
vegas_url <- "https://www.rotowire.com/betting/nfl/odds/week-1"
vegas_page <- rvest::read_html(vegas_url)
vegas_page
vegas_tbls <-
vegas_page %>%
rvest::html_nodes("table")
vegas_tbls
i = 1
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table() %>%
dplyr::mutate(homeaway = if_else(row_number() %% 2 == 0, paste0("home_team"), "away_team"))
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
odds_tbl
i = 2
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
i = 5
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
vegas_tbls
i = 11
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
i = 4
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
i = 3
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
i = 2
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
i = 1
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
i = 2
logger::log_info("Vegas tbl {i}")
odds_tbl <-
vegas_tbls[[i]] %>%
rvest::html_table()
View(odds_tbl)
odds_tbl <-
vegas_tbls[[2]] %>%
rvest::html_table(header = FALSE)
View(odds_tbl)
odds_tbl <-
vegas_tbls[[2]] %>%
rvest::html_table(header = TRUE)
View(odds_tbl)
View(odds_tbl2)
View(odds_tbl)
# vegas_url <- "https://vegas-odds.com/nfl/odds/"
# vegas_url <- "https://sportsbook.draftkings.com/leagues/football/nfl"
vegas_url <- "https://www.rotowire.com/betting/nfl/odds/week-2"
vegas_page <- rvest::read_html(vegas_url)
vegas_page
vegas_tbls <-
vegas_page %>%
rvest::html_nodes("table")
vegas_tbls
odds_tbl <-
vegas_tbls[[2]] %>%
rvest::html_table(header = TRUE)
View(odds_tbl)
odds_tbl <-
vegas_tbls[[1]] %>%
rvest::html_table(header = TRUE)
View(odds_tbl)
vegas_tbls
vegas_page
